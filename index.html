<!DOCTYPE html>
<html lang="en-us">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Traveller Trade</title>
    <link href="css/style.css" rel="stylesheet" />
</head>
<body>
    <h1>Traveller Trade</h1>

    <form id="myForm">
        <fieldset>
            <legend>Source World:</legend>
            <label for="sourceUwp">UWP (Example: B628943-D):</label><br>
            <input type="text" id="sourceUwp" name="sourceUwp" maxlength="9" placeholder="B628943-D" required value="" /><br>
            <label for="sourceTravelZone">Travel Zone:</label><br>
            <select id="sourceTravelZone" name="sourceTravelZone" required>
                <option value=" " selected>Green Zone</option>
                <option value="A">Amber Zone</option>
                <option value="R">Red Zone</option>
            </select>
        </fieldset>
        <fieldset>
            <legend>Destination World:</legend>
            <label for="destinationUwp">UWP (Example: C6678D8-6):</label><br>
            <input type="text" id="destinationUwp" name="destinationUwp" maxlength="9" placeholder="C6678D8-6" required value="" /><br>
            <label for="destinationTravelZone">Travel Zone:</label><br>
            <select id="destinationTravelZone" name="destinationTravelZone" required>
                <option value=" ">Green Zone</option>
                <option value="A" selected>Amber Zone</option>
                <option value="R">Red Zone</option>
            </select>
        </fieldset>
        <label for="parsecsTravelled">Distance (Parsecs):</label>
        <input type="number" id="parsecsTravelled" name="parsecsTravelled" min="1" max="6" required value="1"><br>
        <fieldset>
            <legend>Passenger Traffic Table Modifiers:</legend>
            <label for="brokerCarouseStreetwiseDm">Broker, Carouse, or Streetwise Skill Level:</label>
            <input type="number" id="brokerCarouseStreetwiseDm" min="-3" max="5" required value="1" /><br>
            <label for="chiefStewardSkill">Highest Steward Skill:</label>
            <input type="number" id="chiefStewardSkill" name="chiefStewardSkill" min="0" max="5" required value="1" /><br>
            <label for="miscHighDm">Misc DM (High Passengers):</label>
            <input type="number" id="miscHighDm" min="-3" max="3" required value="0" />
            <label for="miscMiddleDm">Misc DM (Middle Passengers):</label>
            <input type="number" id="miscMiddleDm" min="-3" max="3" required value="0" />
            <label for="miscBasicDm">Misc DM (Basic Passengers):</label>
            <input type="number" id="miscBasicDm" min="-3" max="3" required value="0" />
            <label for="miscLowDm">Misc DM (Low Passengers):</label>
            <input type="number" id="miscLowDm" min="-3" max="3" required value="0" />
        </fieldset>
        <input type="submit" value="Roll For Passengers" />
    </form>

    <h2>Passenger Traffic</h2>

    <p id="passengersResults"></p>
    <p id="viewDetailsMessage" hidden>View console for details (F12).</p>

    <script type="text/javascript" src="js/script.js"></script>
    <script type="text/javascript">
        "use strict";

        function addUwpPatternToHtmlElement(id) {
            const element = document.getElementById(id);

            const regexString = WorlProfile.getRegex().source;
            element.setAttribute("pattern", regexString);
        }

        addUwpPatternToHtmlElement("sourceUwp");
        addUwpPatternToHtmlElement("destinationUwp");

        function onChange() {
            const passengersResults = document.getElementById("passengersResults")
            passengersResults.innerHTML = "";
            const viewDetailsMessage = document.getElementById("viewDetailsMessage")
            viewDetailsMessage.hidden = true;
            console.clear();
        }

        document.getElementById("sourceUwp").addEventListener("change", onChange);
        document.getElementById("sourceTravelZone").addEventListener("change", onChange);
        document.getElementById("destinationUwp").addEventListener("change", onChange);
        document.getElementById("destinationTravelZone").addEventListener("change", onChange);
        document.getElementById("parsecsTravelled").addEventListener("change", onChange);
        document.getElementById("brokerCarouseStreetwiseDm").addEventListener("change", onChange);
        document.getElementById("chiefStewardSkill").addEventListener("change", onChange);
        document.getElementById("miscHighDm").addEventListener("change", onChange);
        document.getElementById("miscMiddleDm").addEventListener("change", onChange);
        document.getElementById("miscBasicDm").addEventListener("change", onChange);
        document.getElementById("miscLowDm").addEventListener("change", onChange);

        document.getElementById("myForm").onsubmit = function (submitEvent) {
            submitEvent.preventDefault(); // don't submit anything
            const passengersResults = document.getElementById("passengersResults")
            passengersResults.innerHTML = "";
            console.clear();
            try {
                const srcUwp = new WorlProfile(document.getElementById("sourceUwp").value, document.getElementById("sourceTravelZone").value);
                const destUwp = new WorlProfile(document.getElementById("destinationUwp").value, document.getElementById("destinationTravelZone").value);

                const brokerCarouseStreetwiseDm = Number(document.getElementById("brokerCarouseStreetwiseDm").value);
                const chiefStewardSkill = Number(document.getElementById("chiefStewardSkill").value);
                const parsecs = Number(document.getElementById("parsecsTravelled").value);

                const miscHighDm = Number(document.getElementById("miscHighDm").value);
                const miscMiddleDm = Number(document.getElementById("miscMiddleDm").value);
                const miscBasicDm = Number(document.getElementById("miscBasicDm").value);
                const miscLowDm = Number(document.getElementById("miscLowDm").value);

                passengersResults.innerHTML =
                    "High Passengers: " + Passengers.availableHighPassengers(brokerCarouseStreetwiseDm, chiefStewardSkill, srcUwp, destUwp, parsecs, miscHighDm) + "<br>" +
                    "Middle Passengers: " + Passengers.availableMiddlePassengers(brokerCarouseStreetwiseDm, chiefStewardSkill, srcUwp, destUwp, parsecs, miscMiddleDm) + "<br>" +
                    "Basic Passengers: " + Passengers.availableBasicPassengers(brokerCarouseStreetwiseDm, chiefStewardSkill, srcUwp, destUwp, parsecs, miscBasicDm) + "<br>" +
                    "Low Passengers: " + Passengers.availableLowPassengers(brokerCarouseStreetwiseDm, chiefStewardSkill, srcUwp, destUwp, parsecs, miscLowDm);

                const viewDetailsMessage = document.getElementById("viewDetailsMessage")
                viewDetailsMessage.hidden = false;
            }
            catch (err) {
                console.error("Error: " + err);
            }
        };

    </script>
</body>
</html>